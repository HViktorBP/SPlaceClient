<div class="quizzes-container">
  <h3> Quizzes </h3>
  <ul>
    <li *ngFor="let quiz of quizzes" (click)="onQuizOpened(quiz, quizContent)">{{quiz.name}}</li>
    <div><p (click)="onAddQuiz(newQuizContent)">Add quiz</p></div>
  </ul>
</div>

<ng-template #newQuizContent let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">New Quiz</h4>
    <button type="button" class="close border" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form (ngSubmit)="onSubmitNewQuiz()" [formGroup]="newQuizForm">
      <div class="form-group">
        <h5>New quiz's name:</h5>
        <input formControlName="name" type="text" id="quiz-name" name="quiz-name" required>
        <h5 style="padding-top: 22px">Questions:</h5>

        <div formArrayName="questions">
          <div *ngFor="let questionControl of questions.controls; let questionIndex = index">
            <hr/>
              <div [formGroupName]="questionIndex">

                <label for="question{{questionIndex}}">Question {{questionIndex + 1}}:</label>
                <input formControlName="question" type="text" placeholder="Your question" id="question{{questionIndex}}" required>

                <button class="delete-button" (click)="onDeleteQuestion(questionIndex)">Delete</button>

                <div *ngIf="answers(questionControl)?.length != 0">
                  <div formArrayName="answers">
                    <div *ngFor="let answersControl of answers(questionControl).controls; let answerIndex = index">
                      <hr/>
                      <div [formGroupName]="answerIndex">
                        <label for="answer{{questionIndex}}{{answerIndex}}">Answer {{answerIndex + 1}}:</label>
                        <input formControlName="answer" type="text" placeholder="Your answer" id="answer{{questionIndex}}{{answerIndex}}" required>
                        <label for="isCorrect{{questionIndex}}{{answerIndex}}">Correct:</label>
                        <input formControlName="isCorrect" type="checkbox" id="isCorrect{{questionIndex}}{{answerIndex}}">
                        <button class="delete-button" (click)="onDeleteAnswer(answerIndex, questionControl)">Delete</button>
                      </div>
                    </div>
                  </div>
                </div>

                <div><p (click)="onAddAnswers(questionControl)">Add Answers</p></div>

              </div>
          </div>
        </div>
        <div><p (click)="onAddQuestion()">Add Question</p></div>
      </div>
      <div class="buttons">
        <hr/>
        <button type="submit" [disabled]="!newQuizForm.valid" class="submit-button">Add new quiz</button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #quizContent let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title-2">{{ quizModel.name }}</h4>
    <button type="button" class="close border" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <form [formGroup]="retrievedQuizForm" (ngSubmit)="onSubmitQuizAnswered()">
    <div formArrayName="questionsRetrieved">
      <div *ngFor="let questionControl of questionsRetrieved.controls; let questionIndex = index">
        <div [formGroupName]="questionIndex">
          <h3>{{ questionIndex + 1 }}. {{questionControl.get('question')?.value}}</h3>
          <div *ngIf="answersRetrieved(questionControl)?.length != 0">
            <div formArrayName="answersRetrieved">
              <div *ngFor="let answersControl of answersRetrieved(questionControl).controls; let answerIndex = index">
                <div [formGroupName]="answerIndex">
                  <input formControlName="isCorrect" type="checkbox" id="isCorrect{{questionIndex}}{{answerIndex}}">
                  <span>{{answerIndex + 1}}. {{ answersControl.get('answer')?.value }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <hr/>
      </div>
    </div>
  </form>
</ng-template>

